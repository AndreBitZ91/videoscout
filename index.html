<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoutMaster Pro</title>
    
    <!-- Tailwind CSS para o design -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configuração de cores e estilos base -->
    <style>
        body { background-color: #020617; color: #f1f5f9; }
        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        
        /* Animação de gravação */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .recording-indicator {
            animation: pulse-red 2s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Importação do React e Lucide via CDN (Módulos ES) -->
    <script type="module">
        import React, { useState, useRef, useEffect, useCallback, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Play, Pause, Scissors, Download, Upload, 
            Trash2, Tag, ChevronRight, Save, X, RotateCcw, 
            FolderInput, Plus, MinusCircle, FileSpreadsheet,
            CheckSquare, Square, Film, Loader2, Clapperboard, MonitorPlay,
            Settings, UserPlus, Users, Shirt, Shield, Swords, FileJson, SaveAll, 
            Database, MapPin, BarChart2, Filter, PieChart, LayoutGrid, RefreshCw, FileVideo, Terminal
        } from 'https://esm.sh/lucide-react@0.263.1';

        // --- Utilitários ---
        const formatTime = (seconds) => {
            if (!seconds && seconds !== 0) return "00:00";
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            const ms = Math.floor((seconds % 1) * 10);
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}.${ms}`;
        };

        // Formatação precisa para exportações
        const formatTimeFull = (seconds) => {
            const date = new Date(seconds * 1000);
            const hh = date.getUTCHours().toString().padStart(2, '0');
            const mm = date.getUTCMinutes().toString().padStart(2, '0');
            const ss = date.getUTCSeconds().toString().padStart(2, '0');
            const ms = date.getUTCMilliseconds().toString().padStart(3, '0');
            return `${hh}:${mm}:${ss}.${ms}`;
        };

        const getCategoryColor = (categoryName) => {
            const lower = categoryName.toLowerCase();
            if (lower === 'posicao' || lower === 'posição') return 'orange';
            if (lower === 'resultado') return 'green';
            if (lower === 'turn over') return 'rose';
            if (lower === 'fase') return 'blue';
            if (lower === 'situação') return 'slate';
            if (lower === 'sanções') return 'red';
            if (lower === 'zona') return 'yellow';
            if (lower === 'combinações') return 'purple';
            return 'blue';
        };

        // --- Dados Estáticos (Definidos antes da App para segurança) ---
        const staticCategories = {
            "Posição": ["Guarda-Redes", "Ponta Esquerda", "Lateral Esquerda", "Central", "Lateral Direita", "Ponta Direita", "Pivot"],
            "Resultado": ["Golo", "Defesa", "Fora", "Falta", "7 Metros"],
            "Turn Over": ["Falha Técnica", "Intercepção"],
            "Fase": ["Ofensiva", "Defensiva", "1ª Vaga", "2ª Vaga", "3ª Vaga", "7 metros"],
            "Situação": ["Igualdade", "Superioridade", "Inferioridade", "Igualdade s/GR", "7x6", "Baliza Aberta"],
            "Sanções": ["2min", "Amarelo", "Vermelho"]
        };
        const zones = ["Zona 1", "Zona 2", "Zona 3", "Zona 4", "Zona 5", "Zona 6", "Zona 7", "Zona 8"];
        const specialZones = ["Zona 2", "Zona 3", "Zona 4"];
        const zoneDetails = ["Remate Média Distância", "Remate Curta Distância"];

        // --- Componentes UI ---
        const TagButton = React.memo(({ label, selected, onClick, color = "blue", onDelete, small = false }) => {
            const baseClasses = `${small ? 'px-3 py-1 text-xs' : 'px-4 py-2 text-sm'} rounded-lg font-semibold transition-all duration-200 border-2 relative group`;
            const variants = {
                blue: selected ? "bg-blue-600 border-blue-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-blue-500 hover:text-white",
                red: selected ? "bg-red-600 border-red-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-red-500 hover:text-white",
                green: selected ? "bg-green-600 border-green-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-green-500 hover:text-white",
                yellow: selected ? "bg-yellow-600 border-yellow-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-yellow-500 hover:text-white",
                slate: selected ? "bg-slate-500 border-slate-500 text-white shadow-lg scale-105" : "bg-slate-900 border-slate-800 text-slate-400 hover:border-slate-600 hover:text-slate-200",
                purple: selected ? "bg-purple-600 border-purple-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-purple-500 hover:text-white",
                orange: selected ? "bg-orange-600 border-orange-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-orange-500 hover:text-white",
                rose: selected ? "bg-rose-600 border-rose-600 text-white shadow-lg scale-105" : "bg-slate-800 border-slate-700 text-slate-300 hover:border-rose-500 hover:text-white",
            };
            return React.createElement('div', { className: "relative inline-block" },
                React.createElement('button', { onClick: onClick, className: `${baseClasses} ${variants[color] || variants.blue}` }, label),
                onDelete && React.createElement('button', { onClick: (e) => { e.stopPropagation(); onDelete(); }, className: "absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm" }, React.createElement(MinusCircle, { size: 12 }))
            );
        });

        // --- Componente: Campo de Andebol 2D (SVG) ---
        const HandballCourt = ({ selectedZones, onToggleZone }) => {
            const isSelected = (z) => selectedZones.includes(z);
            const getClass = (z) => `cursor-pointer transition-all duration-200 hover:opacity-80 ${isSelected(z) ? 'fill-yellow-500 stroke-yellow-300 stroke-2' : 'fill-slate-800/80 stroke-slate-600 hover:fill-slate-700'}`;
            const getTextClass = "text-[12px] fill-white pointer-events-none select-none font-bold opacity-80";

            return React.createElement('div', { className: "relative w-full aspect-[16/9] bg-slate-900 rounded-lg border border-slate-700 overflow-hidden shadow-inner" },
                React.createElement('svg', { viewBox: "0 0 400 220", className: "w-full h-full" },
                    // Linhas do campo base
                    React.createElement('rect', { x: "0", y: "0", width: "400", height: "220", fill: "#0f172a" }),
                    
                    // --- ZONAS DE LONGA DISTÂNCIA (>9m) ---
                    React.createElement('path', { d: "M 0,0 L 133,0 L 133,90 L 0,90 Z", className: getClass("Zona 8"), onClick: () => onToggleZone("Zona 8") }),
                    React.createElement('text', { x: "55", y: "50", className: getTextClass }, "Z8"),

                    React.createElement('path', { d: "M 133,0 L 266,0 L 266,90 L 133,90 Z", className: getClass("Zona 7"), onClick: () => onToggleZone("Zona 7") }),
                    React.createElement('text', { x: "190", y: "50", className: getTextClass }, "Z7"),

                    React.createElement('path', { d: "M 266,0 L 400,0 L 400,90 L 266,90 Z", className: getClass("Zona 6"), onClick: () => onToggleZone("Zona 6") }),
                    React.createElement('text', { x: "325", y: "50", className: getTextClass }, "Z6"),

                    // --- ZONAS DE PONTA (Cantos) ---
                    React.createElement('path', { d: "M 0,90 L 60,90 L 60,220 L 0,220 Z", className: getClass("Zona 5"), onClick: () => onToggleZone("Zona 5") }),
                    React.createElement('text', { x: "20", y: "160", className: getTextClass }, "Z5"),

                    React.createElement('path', { d: "M 340,90 L 400,90 L 400,220 L 340,220 Z", className: getClass("Zona 1"), onClick: () => onToggleZone("Zona 1") }),
                    React.createElement('text', { x: "360", y: "160", className: getTextClass }, "Z1"),

                    // --- ZONAS CENTRAIS (6-9m e Penetração) ---
                    React.createElement('path', { d: "M 60,90 L 140,90 L 140,220 L 60,220 Z", className: getClass("Zona 4"), onClick: () => onToggleZone("Zona 4") }),
                    React.createElement('text', { x: "90", y: "155", className: getTextClass }, "Z4"),

                    React.createElement('path', { d: "M 140,90 L 260,90 L 260,220 L 140,220 Z", className: getClass("Zona 3"), onClick: () => onToggleZone("Zona 3") }),
                    React.createElement('text', { x: "190", y: "155", className: getTextClass }, "Z3"),

                    React.createElement('path', { d: "M 260,90 L 340,90 L 340,220 L 260,220 Z", className: getClass("Zona 2"), onClick: () => onToggleZone("Zona 2") }),
                    React.createElement('text', { x: "290", y: "155", className: getTextClass }, "Z2"),

                    // --- ELEMENTOS VISUAIS ---
                    React.createElement('path', { d: "M 0,90 L 400,90", fill: "none", stroke: "#cbd5e1", strokeWidth: "1", strokeDasharray: "5,5", className: "pointer-events-none opacity-50" }),
                    React.createElement('path', { d: "M 50,220 C 50,160 350,160 350,220", fill: "none", stroke: "#94a3b8", strokeWidth: "2", className: "pointer-events-none opacity-50" }),
                    React.createElement('rect', { x: "170", y: "215", width: "60", height: "5", fill: "#ef4444", className: "pointer-events-none" }) 
                ),
                React.createElement('div', { className: "absolute bottom-1 right-2 text-[9px] text-slate-500 font-mono" }, "Ataque ↓")
            );
        };

        // --- Componente Principal ---
        function App() {
            // --- Estados Base ---
            const [videoSrc, setVideoSrc] = useState(null);
            const [videoFileName, setVideoFileName] = useState("");
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            
            // Estados de Corte
            const [inPoint, setInPoint] = useState(null);
            const [outPoint, setOutPoint] = useState(null);
            const [clips, setClips] = useState([]);
            const [selectedClips, setSelectedClips] = useState([]);
            
            // Dados Equipas
            const [teamDatabase, setTeamDatabase] = useState([]); 
            const [matchInfo, setMatchInfo] = useState({
                teamAId: null, teamBId: null,
                teamA: "Equipa Casa", teamB: "Equipa Fora",
                playersA: [], playersB: []
            });
            const [activeTeam, setActiveTeam] = useState('A'); 
            
            // Modais e UI
            const [isConfigModalOpen, setIsConfigModalOpen] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [showStatsModal, setShowStatsModal] = useState(false);
            const [showFilters, setShowFilters] = useState(false);
            const [showExportMenu, setShowExportMenu] = useState(false);

            // Filtros
            const [filters, setFilters] = useState({ team: 'all', player: 'all', tag: 'all' });

            // Inputs Temporários
            const [tempPlayerA, setTempPlayerA] = useState({ num: '', name: '', pos: '' });
            const [tempPlayerB, setTempPlayerB] = useState({ num: '', name: '', pos: '' });
            const [isProcessing, setIsProcessing] = useState(false);
            const [processingStatus, setProcessingStatus] = useState("");
            
            // Dados de Tagging
            const [currentTags, setCurrentTags] = useState([]);
            const [selectedPlayers, setSelectedPlayers] = useState([]); 
            const [comment, setComment] = useState("");
            const [combinations, setCombinations] = useState([]);
            const [newComboInput, setNewComboInput] = useState("");

            // Refs
            const videoRef = useRef(null);
            const fileInputRef = useRef(null);
            const dbInputRef = useRef(null);
            const comboInputRef = useRef(null); 
            const projectInputRef = useRef(null); // Ref para importar projeto

            // --- Cálculos de Estatísticas ---
            const stats = useMemo(() => {
                const total = clips.length;
                const byTeam = {
                    A: clips.filter(c => c.team === 'A').length,
                    B: clips.filter(c => c.team === 'B').length
                };
                
                const isShot = (c) => c.tags.some(t => ["Golo", "Defesa", "Fora"].includes(t));
                const shotsA = clips.filter(c => c.team === 'A' && isShot(c));
                const goalsA = shotsA.filter(c => c.tags.includes("Golo")).length;
                const shotsB = clips.filter(c => c.team === 'B' && isShot(c));
                const goalsB = shotsB.filter(c => c.tags.includes("Golo")).length;

                const playerCounts = {};
                clips.forEach(c => {
                    c.players.forEach(p => {
                        const key = `${p.number} - ${p.name} (${c.team === 'A' ? matchInfo.teamA : matchInfo.teamB})`;
                        playerCounts[key] = (playerCounts[key] || 0) + 1;
                    });
                });
                const topPlayers = Object.entries(playerCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5);

                return { total, byTeam, shotsA, goalsA, shotsB, goalsB, topPlayers };
            }, [clips, matchInfo.teamA, matchInfo.teamB]);

            // --- Filtragem de Clips ---
            const filteredClips = useMemo(() => {
                return clips.filter(clip => {
                    if (filters.team !== 'all' && clip.team !== filters.team) return false;
                    if (filters.tag !== 'all' && !clip.tags.includes(filters.tag)) return false;
                    if (filters.player !== 'all' && !clip.players.some(p => p.id.toString() === filters.player)) return false;
                    return true;
                });
            }, [clips, filters]);

            // Cleanup & Keyboard
            useEffect(() => { return () => { if (videoSrc) URL.revokeObjectURL(videoSrc); }; }, [videoSrc]);
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (isModalOpen || isProcessing || isConfigModalOpen || showStatsModal) return;
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;
                    switch (e.key.toLowerCase()) {
                        case ' ': e.preventDefault(); togglePlay(); break;
                        case 'z': setIn(); break;
                        case 'x': setOutAndOpenModal(); break;
                        case 'a': setActiveTeam('A'); break;
                        case 's': setActiveTeam('B'); break;
                        case 'arrowleft': if(videoRef.current) videoRef.current.currentTime = Math.max(0, videoRef.current.currentTime - 3); break;
                        case 'arrowright': if(videoRef.current) videoRef.current.currentTime = Math.min(duration, videoRef.current.currentTime + 3); break;
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [isPlaying, isModalOpen, duration, isProcessing, isConfigModalOpen, showStatsModal]);

            // --- Funções Auxiliares ---
            const togglePlay = () => { if (videoRef.current) { if (isPlaying) videoRef.current.pause(); else videoRef.current.play(); setIsPlaying(!isPlaying); } };
            const setIn = useCallback(() => { if (videoRef.current) setInPoint(videoRef.current.currentTime); }, []);
            const setOutAndOpenModal = useCallback(() => {
                if (!videoRef.current) return;
                const time = videoRef.current.currentTime;
                setOutPoint(time); videoRef.current.pause(); setIsPlaying(false);
                if (inPoint === null) setInPoint(Math.max(0, time - 5));
                setIsModalOpen(true);
            }, [inPoint]);

            const toggleTag = useCallback((tag) => setCurrentTags(prev => prev.includes(tag) ? prev.filter(t => t !== tag) : [...prev, tag]), []);
            
            const togglePlayerSelection = useCallback((player) => {
                setSelectedPlayers(prev => {
                    const isSelecting = !prev.some(p => p.id === player.id);
                    if (isSelecting && player.position) {
                        setCurrentTags(tags => {
                            if (!tags.includes(player.position) && staticCategories["Posição"].includes(player.position)) {
                                return [...tags, player.position];
                            }
                            return tags;
                        });
                    }
                    return isSelecting ? [...prev, player] : prev.filter(p => p.id !== player.id);
                });
            }, []);

            const saveClip = () => {
                setClips([...clips, { id: Date.now(), start: inPoint, end: outPoint, duration: outPoint - inPoint, tags: currentTags, players: selectedPlayers, team: activeTeam, comment: comment }]);
                closeModal();
            };
            const closeModal = () => { setIsModalOpen(false); setInPoint(null); setOutPoint(null); setCurrentTags([]); setSelectedPlayers([]); setComment(""); };
            const deleteClip = (id) => { setClips(clips.filter(c => c.id !== id)); setSelectedClips(selectedClips.filter(sid => sid !== id)); };
            const jumpToClip = (start) => { if (videoRef.current) { videoRef.current.currentTime = start; videoRef.current.play(); setIsPlaying(true); } };
            
            const handleFileUpload = (e) => { const f = e.target.files[0]; if(f) { setVideoSrc(URL.createObjectURL(f)); setVideoFileName(f.name); }};
            const addCombination = () => { if(newComboInput.trim() && !combinations.includes(newComboInput.trim())) { setCombinations([...combinations, newComboInput.trim()]); setNewComboInput(""); }};
            
            // --- Gestão de Projetos (Save/Load) ---
            const saveProject = () => {
                const projectData = {
                    version: "1.1",
                    timestamp: new Date().toISOString(),
                    matchInfo,
                    clips,
                    combinations,
                    videoFileName
                };
                const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `projeto_scoutmaster_${new Date().toISOString().slice(0,10)}.json`;
                document.body.appendChild(a);
                a.click();
                a.remove();
            };

            const loadProject = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.matchInfo && Array.isArray(data.clips)) {
                            if(confirm("Carregar este projeto irá substituir os dados atuais. Deseja continuar?")) {
                                setMatchInfo(data.matchInfo);
                                setClips(data.clips);
                                if(data.combinations) setCombinations(data.combinations);
                                setSelectedClips([]);
                                alert(`Projeto carregado com sucesso!\n\nNota: Por limitações de segurança do navegador, deve carregar novamente o ficheiro de vídeo: "${data.videoFileName || 'desconhecido'}"`);
                            }
                        } else {
                            alert("Ficheiro de projeto inválido.");
                        }
                    } catch (err) {
                        alert("Erro ao ler o ficheiro de projeto.");
                    }
                };
                reader.readAsText(file);
            };

            // --- EXPORTAÇÕES (CSV, FFMPEG, XML) ---
            
            // 1. Exportar CSV (Excel)
            const exportCSV = () => {
                let csvContent = "data:text/csv;charset=utf-8,";
                // Cabeçalho
                csvContent += "ID,Inicio,Fim,Duracao,Equipa,Jogadores,Tags,Nota\n";
                
                clips.forEach(c => {
                    const teamName = c.team === 'A' ? matchInfo.teamA : matchInfo.teamB;
                    const playersStr = c.players.map(p => `${p.number} ${p.name}`).join(';');
                    const tagsStr = c.tags.join(';');
                    const noteStr = (c.comment || '').replace(/,/g, ' '); // Remover vírgulas para não quebrar CSV
                    
                    csvContent += `${c.id},${formatTime(c.start)},${formatTime(c.end)},${c.duration.toFixed(2)},"${teamName}","${playersStr}","${tagsStr}","${noteStr}"\n`;
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", `analise_dados_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                link.remove();
            };

            // 2. Exportar Script FFmpeg (.bat para Windows)
            const exportFFmpeg = () => {
                if (!videoFileName) {
                    alert("Atenção: Nenhum vídeo carregado. O script será gerado com o nome 'video.mp4'. Edite o ficheiro se necessário.");
                }
                const vName = videoFileName || "video.mp4";
                
                let content = `:: Script gerado por ScoutMaster Pro (Windows)\n`;
                content += `:: Coloque este ficheiro na mesma pasta que o vídeo "${vName}" e execute-o.\n`;
                content += `:: Requer FFmpeg instalado.\n\n`;
                content += `mkdir "Cortes"\n\n`;

                clips.forEach((c, index) => {
                    let safeTags = c.tags.slice(0, 3).join('_').replace(/[^a-zA-Z0-9]/g, '');
                    let safeTeam = (c.team === 'A' ? matchInfo.teamA : matchInfo.teamB).replace(/[^a-zA-Z0-9]/g, '');
                    if(safeTags.length === 0) safeTags = "clip";
                    const outputName = `Cortes\\${String(index+1).padStart(3,'0')}_${safeTeam}_${safeTags}.mp4`;
                    content += `ffmpeg -i "${vName}" -ss ${formatTimeFull(c.start)} -to ${formatTimeFull(c.end)} -c copy -avoid_negative_ts 1 "${outputName}"\n`;
                });

                content += `\necho Concluido! Pode fechar esta janela.\npause`;

                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `cortar_videos_win.bat`;
                document.body.appendChild(a);
                a.click();
                a.remove();
                
                alert("Script Windows (.bat) gerado!");
            };

            // 3. Exportar Script FFmpeg (.command para Mac - Duplo Clique)
            const exportFFmpegMac = () => {
                if (!videoFileName) {
                    alert("Atenção: Nenhum vídeo carregado. O script será gerado com o nome 'video.mp4'.");
                }
                const vName = videoFileName || "video.mp4";
                
                let content = `#!/bin/bash\n`;
                content += `# Script gerado por ScoutMaster Pro (Mac/Linux)\n`;
                content += `# Este ficheiro deve estar na mesma pasta que o vídeo "${vName}".\n\n`;
                
                // Mudar para o diretório onde o script está localizado (essencial para .command)
                content += `cd "$(dirname "$0")" || exit\n\n`;
                
                content += `mkdir -p "Cortes"\n\n`;
                content += `VIDEO_FILE="${vName}"\n\n`;
                
                content += `if [ ! -f "$VIDEO_FILE" ]; then\n`;
                content += `  echo "Erro: Ficheiro de vídeo '$VIDEO_FILE' não encontrado nesta pasta."\n`;
                content += `  echo "Certifique-se que o script e o vídeo estão no mesmo local."\n`;
                content += `  read -p "Pressione Enter para sair..."\n`;
                content += `  exit 1\n`;
                content += `fi\n\n`;

                clips.forEach((c, index) => {
                    let safeTags = c.tags.slice(0, 3).join('_').replace(/[^a-zA-Z0-9]/g, '');
                    let safeTeam = (c.team === 'A' ? matchInfo.teamA : matchInfo.teamB).replace(/[^a-zA-Z0-9]/g, '');
                    if(safeTags.length === 0) safeTags = "clip";
                    
                    const outputName = `Cortes/${String(index+1).padStart(3,'0')}_${safeTeam}_${safeTags}.mp4`;
                    
                    content += `echo "A processar corte ${index+1}..."\n`;
                    content += `ffmpeg -i "$VIDEO_FILE" -ss ${formatTimeFull(c.start)} -to ${formatTimeFull(c.end)} -c copy -avoid_negative_ts 1 "${outputName}"\n`;
                });

                content += `\necho "Concluído! Verifique a pasta Cortes."\n`;
                // Manter janela aberta para ver o resultado
                content += `read -p "Pressione Enter para fechar..."\n`;

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                // Mudança para .command para ser executável por clique (após permissão)
                a.download = `cortar_videos.command`; 
                document.body.appendChild(a);
                a.click();
                a.remove();
                
                alert("Script Mac (.command) gerado!\n\nIMPORTANTE (Primeira Utilização):\n1. Coloque o ficheiro na pasta do vídeo.\n2. O Mac bloqueia scripts descarregados por segurança.\n3. Abra o Terminal, escreva 'chmod +x ' (com espaço no fim) e arraste o ficheiro para lá. Pressione Enter.\n\nDepois disto, basta fazer DUPLO CLIQUE no ficheiro para cortar os vídeos sempre que quiser!");
            };

            // 4. Exportar XML (Existente)
            const exportXML = () => {
                let xml = '<?xml version="1.0" encoding="UTF-8"?>\n<analise>\n';
                clips.forEach(c => {
                    const teamName = c.team === 'A' ? matchInfo.teamA : matchInfo.teamB;
                    xml += `  <corte id="${c.id}">\n`;
                    xml += `    <inicio>${c.start.toFixed(2)}</inicio>\n`;
                    xml += `    <fim>${c.end.toFixed(2)}</fim>\n`;
                    xml += `    <equipa>${teamName}</equipa>\n`;
                    if (c.players.length > 0) {
                        xml += `    <jogadores>\n`;
                        c.players.forEach(p => {
                            xml += `      <jogador numero="${p.number}">${p.name}</jogador>\n`;
                        });
                        xml += `    </jogadores>\n`;
                    } else { xml += `    <jogadores/>\n`; }
                    xml += `    <tags>${c.tags.join(',')}</tags>\n`;
                    xml += `    <nota>${c.comment || ''}</nota>\n`;
                    xml += `  </corte>\n`;
                });
                xml += '</analise>';
                const b = new Blob([xml], {type:'text/xml'});
                const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'analise.xml'; document.body.appendChild(a); a.click(); a.remove();
            };

            const handleComboImport = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (Array.isArray(imported)) {
                            setCombinations(prev => [...new Set([...prev, ...imported])]);
                            alert(`${imported.length} combinações importadas!`);
                        }
                    } catch (err) { alert("Erro ao importar combinações."); }
                };
                reader.readAsText(file);
            };

            // --- Gestão de Equipas (Funções auxiliares repetidas para contexto) ---
            const addPlayer = (side) => {
                const inp = side === 'A' ? tempPlayerA : tempPlayerB;
                if(!inp.num || !inp.name) return;
                const newP = { id: Date.now(), number: inp.num, name: inp.name, position: inp.pos || '' };
                setMatchInfo(prev => {
                    const key = side === 'A' ? 'playersA' : 'playersB';
                    const newPlayers = [...prev[key], newP];
                    const teamId = side === 'A' ? prev.teamAId : prev.teamBId;
                    if (teamId) { setTeamDatabase(db => db.map(t => t.id === teamId ? { ...t, players: newPlayers } : t)); }
                    return { ...prev, [key]: newPlayers };
                });
                if(side === 'A') setTempPlayerA({num:'', name:'', pos:''}); else setTempPlayerB({num:'', name:'', pos:''});
            };

            const removePlayer = (side, id) => {
                setMatchInfo(prev => {
                    const key = side === 'A' ? 'playersA' : 'playersB';
                    const newPlayers = prev[key].filter(p => p.id !== id);
                    const teamId = side === 'A' ? prev.teamAId : prev.teamBId;
                    if (teamId) { setTeamDatabase(db => db.map(t => t.id === teamId ? { ...t, players: newPlayers } : t)); }
                    return { ...prev, [key]: newPlayers };
                });
            };

            const exportDatabase = () => {
                const data = JSON.stringify({ version: "1.0", teams: teamDatabase });
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `BASE_DADOS_EQUIPAS.json`; document.body.appendChild(a); a.click(); a.remove();
            };

            const loadDatabase = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (evt) => {
                    try {
                        const data = JSON.parse(evt.target.result);
                        if (Array.isArray(data.teams)) {
                            setTeamDatabase(prev => {
                                const newTeams = data.teams.filter(t => !prev.some(p => p.id === t.id));
                                return [...prev, ...newTeams];
                            });
                            alert(`${data.teams.length} equipas carregadas com sucesso!`);
                        }
                    } catch (err) { alert("Erro no ficheiro de equipas."); }
                };
                reader.readAsText(file);
            };

            const selectTeamFromDB = (side, teamId) => {
                if (teamId === "new") {
                    setMatchInfo(prev => ({ ...prev, [side === 'A' ? 'teamAId' : 'teamBId']: null, [side === 'A' ? 'teamA' : 'teamB']: side === 'A' ? "Nova Equipa A" : "Nova Equipa B", [side === 'A' ? 'playersA' : 'playersB']: [] }));
                    return;
                }
                const team = teamDatabase.find(t => t.id.toString() === teamId.toString());
                if (team) {
                    setMatchInfo(prev => ({ ...prev, [side === 'A' ? 'teamAId' : 'teamBId']: team.id, [side === 'A' ? 'teamA' : 'teamB']: team.name, [side === 'A' ? 'playersA' : 'playersB']: team.players || [] }));
                }
            };
            
            const handleTeamNameChange = (side, newName) => {
                setMatchInfo(prev => {
                    const teamId = side === 'A' ? prev.teamAId : prev.teamBId;
                    if (teamId) { setTeamDatabase(db => db.map(t => t.id === teamId ? { ...t, name: newName } : t)); }
                    else if (newName.trim() !== "") { const newId = Date.now() + (side === 'A' ? 0 : 1); setTeamDatabase(db => [...db, { id: newId, name: newName, players: [] }]); return { ...prev, [side==='A'?'teamAId':'teamBId']: newId, [side==='A'?'teamA':'teamB']: newName }; }
                    return { ...prev, [side==='A'?'teamA':'teamB']: newName };
                });
            };

            const exportCombinations = () => {
                const data = JSON.stringify(combinations);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `combinacoes_taticas.json`; document.body.appendChild(a); a.click(); a.remove();
            };

            return React.createElement('div', { className: "flex flex-col h-screen bg-slate-950 text-slate-100 font-sans overflow-hidden" },
                
                // --- MODAL DE ESTATÍSTICAS ---
                showStatsModal && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-slate-900 w-full max-w-5xl rounded-2xl shadow-2xl border border-slate-700 overflow-hidden flex flex-col max-h-[90vh]" },
                        React.createElement('div', { className: "p-6 border-b border-slate-800 flex justify-between items-center" },
                            React.createElement('h3', { className: "text-xl font-bold text-white flex items-center gap-2" }, React.createElement(BarChart2, { className: "text-blue-500" }), "Dashboard do Jogo"),
                            React.createElement('button', { onClick: () => setShowStatsModal(false), className: "p-2 hover:bg-slate-700 rounded-full" }, React.createElement(X))
                        ),
                        React.createElement('div', { className: "p-6 overflow-y-auto grid grid-cols-1 md:grid-cols-3 gap-6" },
                            // Card Geral
                            React.createElement('div', { className: "bg-slate-800 p-4 rounded-xl border border-slate-700 col-span-1 md:col-span-3 flex justify-around items-center" },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('div', { className: "text-3xl font-bold text-white" }, stats.total),
                                    React.createElement('div', { className: "text-xs text-slate-400 uppercase" }, "Total Cortes")
                                ),
                                React.createElement('div', { className: "h-10 w-px bg-slate-700" }),
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('div', { className: "text-2xl font-bold text-blue-400" }, stats.byTeam.A),
                                    React.createElement('div', { className: "text-xs text-slate-400 uppercase" }, matchInfo.teamA)
                                ),
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('div', { className: "text-2xl font-bold text-red-400" }, stats.byTeam.B),
                                    React.createElement('div', { className: "text-xs text-slate-400 uppercase" }, matchInfo.teamB)
                                )
                            ),
                            // Eficácia Equipa A
                            React.createElement('div', { className: "bg-slate-800 p-4 rounded-xl border border-slate-700" },
                                React.createElement('h4', { className: "font-bold text-blue-400 mb-4" }, `Eficácia ${matchInfo.teamA}`),
                                React.createElement('div', { className: "flex items-end gap-2 mb-2" },
                                    React.createElement('span', { className: "text-4xl font-bold" }, Math.round((stats.goalsA / (stats.shotsA.length || 1)) * 100)),
                                    React.createElement('span', { className: "text-xl text-slate-500" }, "%")
                                ),
                                React.createElement('div', { className: "w-full bg-slate-700 h-2 rounded-full overflow-hidden" },
                                    React.createElement('div', { className: "bg-blue-500 h-full", style: { width: `${(stats.goalsA / (stats.shotsA.length || 1)) * 100}%` } })
                                ),
                                React.createElement('p', { className: "text-xs text-slate-400 mt-2" }, `${stats.goalsA} golos em ${stats.shotsA.length} remates`)
                            ),
                            // Eficácia Equipa B
                            React.createElement('div', { className: "bg-slate-800 p-4 rounded-xl border border-slate-700" },
                                React.createElement('h4', { className: "font-bold text-red-400 mb-4" }, `Eficácia ${matchInfo.teamB}`),
                                React.createElement('div', { className: "flex items-end gap-2 mb-2" },
                                    React.createElement('span', { className: "text-4xl font-bold" }, Math.round((stats.goalsB / (stats.shotsB.length || 1)) * 100)),
                                    React.createElement('span', { className: "text-xl text-slate-500" }, "%")
                                ),
                                React.createElement('div', { className: "w-full bg-slate-700 h-2 rounded-full overflow-hidden" },
                                    React.createElement('div', { className: "bg-red-500 h-full", style: { width: `${(stats.goalsB / (stats.shotsB.length || 1)) * 100}%` } })
                                ),
                                React.createElement('p', { className: "text-xs text-slate-400 mt-2" }, `${stats.goalsB} golos em ${stats.shotsB.length} remates`)
                            ),
                            // Top Jogadores
                            React.createElement('div', { className: "bg-slate-800 p-4 rounded-xl border border-slate-700 row-span-2" },
                                React.createElement('h4', { className: "font-bold text-white mb-4 flex items-center gap-2" }, React.createElement(Swords, { size: 16 }), "Top Intervenções"),
                                React.createElement('div', { className: "space-y-3" },
                                    stats.topPlayers.map(([name, count], i) => 
                                        React.createElement('div', { key: i, className: "flex justify-between items-center border-b border-slate-700 pb-2 last:border-0" },
                                            React.createElement('span', { className: "text-sm text-slate-300" }, `${i+1}. ${name}`),
                                            React.createElement('span', { className: "font-bold text-white bg-slate-700 px-2 py-0.5 rounded text-xs" }, count)
                                        )
                                    )
                                )
                            )
                        )
                    )
                ),

                // Modal de Configuração de Jogo
                isConfigModalOpen && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-slate-900 w-full max-w-4xl rounded-2xl flex flex-col max-h-[90vh] overflow-hidden" },
                        React.createElement('div', { className: "p-6 border-b border-slate-800 flex justify-between items-center bg-slate-800/50" },
                            React.createElement('h2', { className: "text-xl font-bold flex items-center gap-2" }, React.createElement(Database, { size: 20, className: "text-blue-400" }), "Gestão de Equipas"),
                            React.createElement('div', { className: "flex gap-2" },
                                React.createElement('input', { type: "file", accept: ".json", onChange: loadDatabase, ref: dbInputRef, className: "hidden" }),
                                React.createElement('button', { onClick: () => dbInputRef.current.click(), className: "flex items-center gap-2 px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded text-xs font-bold" }, React.createElement(FolderInput, { size: 14 }), "Importar BD"),
                                React.createElement('button', { onClick: exportDatabase, className: "flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-500 rounded text-xs font-bold" }, React.createElement(SaveAll, { size: 14 }), "Guardar BD"),
                                React.createElement('button', { onClick: () => setIsConfigModalOpen(false), className: "p-1.5 hover:bg-slate-700 rounded-full ml-2" }, React.createElement(X, { size: 20 }))
                            )
                        ),
                        React.createElement('div', { className: "p-6 overflow-y-auto grid grid-cols-2 gap-8 bg-slate-900" },
                            React.createElement('div', null,
                                React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                    React.createElement('h3', { className: "text-blue-400 font-bold" }, "Equipa A"),
                                    React.createElement('span', { className: "text-xs text-slate-500" }, "Casa")
                                ),
                                React.createElement('select', { 
                                    className: "w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm mb-2 text-slate-300",
                                    onChange: (e) => selectTeamFromDB('A', e.target.value),
                                    value: matchInfo.teamAId || "new"
                                },
                                    React.createElement('option', { value: "new" }, "--- Criar Nova Equipa ---"),
                                    teamDatabase.map(t => React.createElement('option', { key: t.id, value: t.id }, t.name))
                                ),
                                React.createElement('input', { className: "w-full bg-slate-950 border border-slate-700 p-2 rounded mb-4 font-bold text-white", value: matchInfo.teamA, onChange: e => handleTeamNameChange('A', e.target.value), placeholder: "Nome da Equipa" }),
                                React.createElement('div', { className: "flex gap-2 mb-2" },
                                    React.createElement('input', { placeholder: "#", className: "w-12 bg-slate-800 p-2 rounded text-center text-sm", value: tempPlayerA.num, onChange: e => setTempPlayerA({...tempPlayerA, num: e.target.value}) }),
                                    React.createElement('input', { placeholder: "Nome", className: "flex-1 bg-slate-800 p-2 rounded text-sm", value: tempPlayerA.name, onChange: e => setTempPlayerA({...tempPlayerA, name: e.target.value}) }),
                                    
                                    React.createElement('select', { 
                                        className: "w-24 bg-slate-800 p-2 rounded text-sm text-slate-300", 
                                        value: tempPlayerA.pos, 
                                        onChange: e => setTempPlayerA({...tempPlayerA, pos: e.target.value}) 
                                    },
                                        React.createElement('option', { value: "" }, "Pos (opc)"),
                                        staticCategories["Posição"].map(p => React.createElement('option', { key: p, value: p }, p))
                                    ),

                                    React.createElement('button', { onClick: () => addPlayer('A'), className: "bg-blue-600 p-2 rounded hover:bg-blue-500" }, React.createElement(Plus, { size: 16 }))
                                ),
                                React.createElement('div', { className: "max-h-60 overflow-y-auto space-y-1" }, 
                                    matchInfo.playersA.map(p => React.createElement('div', { key: p.id, className: "flex justify-between items-center text-sm p-2 bg-slate-800 rounded" }, 
                                        React.createElement('span', null, React.createElement('span', { className: "text-blue-400 font-mono font-bold mr-2" }, p.number), p.name, p.position && React.createElement('span', { className: "text-xs text-slate-500 ml-2" }, `(${p.position})`)), 
                                        React.createElement('button', { onClick: () => removePlayer('A', p.id), className: "text-slate-500 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                    ))
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                    React.createElement('h3', { className: "text-red-400 font-bold" }, "Equipa B"),
                                    React.createElement('span', { className: "text-xs text-slate-500" }, "Fora")
                                ),
                                React.createElement('select', { 
                                    className: "w-full bg-slate-800 border border-slate-700 rounded p-2 text-sm mb-2 text-slate-300",
                                    onChange: (e) => selectTeamFromDB('B', e.target.value),
                                    value: matchInfo.teamBId || "new"
                                },
                                    React.createElement('option', { value: "new" }, "--- Criar Nova Equipa ---"),
                                    teamDatabase.map(t => React.createElement('option', { key: t.id, value: t.id }, t.name))
                                ),
                                React.createElement('input', { className: "w-full bg-slate-950 border border-slate-700 p-2 rounded mb-4 font-bold text-white", value: matchInfo.teamB, onChange: e => handleTeamNameChange('B', e.target.value), placeholder: "Nome da Equipa" }),
                                React.createElement('div', { className: "flex gap-2 mb-2" },
                                    React.createElement('input', { placeholder: "#", className: "w-12 bg-slate-800 p-2 rounded text-center text-sm", value: tempPlayerB.num, onChange: e => setTempPlayerB({...tempPlayerB, num: e.target.value}) }),
                                    React.createElement('input', { placeholder: "Nome", className: "flex-1 bg-slate-800 p-2 rounded text-sm", value: tempPlayerB.name, onChange: e => setTempPlayerB({...tempPlayerB, name: e.target.value}) }),
                                    
                                    React.createElement('select', { 
                                        className: "w-24 bg-slate-800 p-2 rounded text-sm text-slate-300", 
                                        value: tempPlayerB.pos, 
                                        onChange: e => setTempPlayerB({...tempPlayerB, pos: e.target.value}) 
                                    },
                                        React.createElement('option', { value: "" }, "Pos (opc)"),
                                        staticCategories["Posição"].map(p => React.createElement('option', { key: p, value: p }, p))
                                    ),

                                    React.createElement('button', { onClick: () => addPlayer('B'), className: "bg-red-600 p-2 rounded hover:bg-red-500" }, React.createElement(Plus, { size: 16 }))
                                ),
                                React.createElement('div', { className: "max-h-60 overflow-y-auto space-y-1" }, 
                                    matchInfo.playersB.map(p => React.createElement('div', { key: p.id, className: "flex justify-between items-center text-sm p-2 bg-slate-800 rounded" }, 
                                        React.createElement('span', null, React.createElement('span', { className: "text-red-400 font-mono font-bold mr-2" }, p.number), p.name, p.position && React.createElement('span', { className: "text-xs text-slate-500 ml-2" }, `(${p.position})`)), 
                                        React.createElement('button', { onClick: () => removePlayer('B', p.id), className: "text-slate-500 hover:text-red-500" }, React.createElement(Trash2, { size: 14 }))
                                    ))
                                )
                            )
                        ),
                        React.createElement('div', { className: "p-4 bg-slate-800 border-t border-slate-700 flex justify-end" },
                            React.createElement('button', { onClick: () => setIsConfigModalOpen(false), className: "px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold" }, "Concluir")
                        )
                    )
                ),

                // --- MODAL DE TAGGING ---
                isModalOpen && React.createElement('div', { className: "fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-slate-900 w-full max-w-4xl rounded-2xl shadow-2xl border border-slate-700 overflow-hidden flex flex-col max-h-[95vh]" },
                        React.createElement('div', { className: "p-4 border-b border-slate-800 flex justify-between items-center bg-slate-800/50" },
                            React.createElement('div', null,
                                React.createElement('h3', { className: "text-lg font-bold text-white flex items-center gap-2" }, "Classificar Lance", 
                                    // BOTAO DE TROCA DE EQUIPA NO HEADER
                                    React.createElement('button', { 
                                        onClick: () => { setActiveTeam(prev => prev === 'A' ? 'B' : 'A'); setSelectedPlayers([]); },
                                        className: `text-xs px-2 py-1 rounded border font-bold flex items-center gap-2 hover:opacity-80 transition-all ${activeTeam==='A'?'border-blue-500 text-blue-400 bg-blue-500/10':'border-red-500 text-red-400 bg-red-500/10'}` 
                                    }, 
                                        activeTeam==='A' ? matchInfo.teamA : matchInfo.teamB,
                                        React.createElement(RotateCcw, { size: 12 })
                                    )
                                ),
                                React.createElement('p', { className: "text-xs text-slate-400 font-mono" }, `${formatTime(inPoint)} - ${formatTime(outPoint)}`)
                            ),
                            React.createElement('button', { onClick: closeModal }, React.createElement(X))
                        ),
                        React.createElement('div', { className: "p-4 overflow-y-auto flex-1 flex flex-col gap-4" },
                            
                            // 1. Jogadores
                            React.createElement('div', { className: "bg-slate-800/30 p-3 rounded-lg border border-slate-700/50" },
                                React.createElement('h4', { className: "text-[10px] font-bold text-slate-500 uppercase mb-2" }, "Jogadores"),
                                React.createElement('div', { className: "flex gap-2 overflow-x-auto pb-2" },
                                    (activeTeam === 'A' ? matchInfo.playersA : matchInfo.playersB).map(p => 
                                        React.createElement(TagButton, { key: p.id, label: `${p.number} ${p.name.split(' ')[0]}`, selected: selectedPlayers.some(sp=>sp.id===p.id), onClick: () => togglePlayerSelection(p), small: true, color: "slate" })
                                    )
                                )
                            ),

                            React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                                // Coluna Esquerda: Tags
                                React.createElement('div', { className: "space-y-4" },
                                    
                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-orange-500 uppercase mb-2" }, "Posição de Jogador"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, staticCategories["Posição"].map(t => React.createElement(TagButton, { key: t, label: t, color: "orange", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    ),

                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-green-500 uppercase mb-2" }, "Resultado"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, staticCategories["Resultado"].map(t => React.createElement(TagButton, { key: t, label: t, color: "green", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    ),

                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-rose-500 uppercase mb-2" }, "Turn Over"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, staticCategories["Turn Over"].map(t => React.createElement(TagButton, { key: t, label: t, color: "rose", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    ),
                                    
                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-blue-500 uppercase mb-2" }, "Fase"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, staticCategories["Fase"].map(t => React.createElement(TagButton, { key: t, label: t, color: "blue", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    ),
                                    
                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-slate-500 uppercase mb-2" }, "Situação"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, staticCategories["Situação"].map(t => React.createElement(TagButton, { key: t, label: t, color: "slate", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    ),

                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-yellow-500 uppercase mb-2" }, "Zona"),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, zones.map(t => React.createElement(TagButton, { key: t, label: t, color: "yellow", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true }))),
                                        currentTags.some(t => specialZones.includes(t)) && React.createElement('div', { className: "mt-2 flex flex-wrap gap-2 animate-in fade-in" },
                                            zoneDetails.map(t => React.createElement(TagButton, { key: t, label: t, color: "yellow", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true }))
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "flex justify-between items-center mb-2" },
                                            React.createElement('h4', { className: "text-[10px] font-bold text-purple-400 uppercase" }, "Combinações"),
                                            React.createElement('div', { className: "flex gap-2" },
                                                React.createElement('input', { type: "file", className: "hidden", ref: comboInputRef, onChange: handleComboImport, accept: ".json" }),
                                                React.createElement('button', { onClick: () => comboInputRef.current.click(), title: "Importar Combinações", className: "text-slate-400 hover:text-white" }, React.createElement(FolderInput, { size: 14 })),
                                                React.createElement('button', { onClick: exportCombinations, title: "Exportar Combinações", className: "text-slate-400 hover:text-white" }, React.createElement(Download, { size: 14 }))
                                            )
                                        ),
                                        React.createElement('div', { className: "flex gap-2 mb-2" },
                                            React.createElement('input', { className: "bg-slate-950 border border-slate-700 rounded text-xs px-2 py-1 w-full", placeholder: "Nova...", value: newComboInput, onChange: e => setNewComboInput(e.target.value) }),
                                            React.createElement('button', { onClick: addCombination, className: "bg-purple-600 px-2 rounded" }, React.createElement(Plus, { size: 14 }))
                                        ),
                                        React.createElement('div', { className: "flex flex-wrap gap-2" }, combinations.map(t => React.createElement(TagButton, { key: t, label: t, color: "purple", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true })))
                                    )
                                ),
                                React.createElement('div', { className: "space-y-4" },
                                    React.createElement('div', null,
                                        React.createElement('h4', { className: "text-[10px] font-bold text-yellow-500 uppercase mb-2 flex items-center gap-2" }, React.createElement(MapPin, { size: 12 }), "Zona de Finalização"),
                                        React.createElement(HandballCourt, { selectedZones: currentTags, onToggleZone: toggleTag }),
                                        currentTags.some(t => specialZones.includes(t)) && React.createElement('div', { className: "mt-2 bg-yellow-900/10 p-2 rounded border border-yellow-800/30 flex gap-2 justify-center animate-in fade-in" },
                                            zoneDetails.map(t => React.createElement(TagButton, { key: t, label: t, color: "yellow", selected: currentTags.includes(t), onClick: () => toggleTag(t), small: true }))
                                        )
                                    ),
                                    React.createElement('textarea', { placeholder: "Notas...", className: "w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs h-16", value: comment, onChange: e => setComment(e.target.value) })
                                )
                            )
                        ),
                        React.createElement('div', { className: "p-4 bg-slate-800/50 border-t border-slate-800 flex justify-end gap-2" },
                            React.createElement('button', { onClick: closeModal, className: "px-4 py-2 rounded text-sm text-slate-400 hover:bg-slate-800" }, "Cancelar"),
                            React.createElement('button', { onClick: saveClip, className: "px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-sm font-bold shadow-lg" }, "Guardar")
                        )
                    )
                ),

                // Header
                React.createElement('header', { className: "h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900" },
                    React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement(Scissors, { className: "text-blue-500 w-6 h-6" }),
                        React.createElement('h1', { className: "text-xl font-bold tracking-tight" }, "ScoutMaster ", React.createElement('span', { className: "text-blue-500" }, "Pro"))
                    ),
                    React.createElement('div', { className: "flex items-center gap-2" },
                        React.createElement('button', { onClick: () => setShowStatsModal(true), className: "flex items-center gap-2 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-md text-sm font-medium transition-colors border border-slate-700 mr-2 text-purple-400" }, React.createElement(BarChart2, { size: 16 }), "Estatísticas"),
                        
                        // Menu Exportar (Dropdown simplificado visualmente com botões)
                        React.createElement('div', { className: "h-6 w-px bg-slate-800 mx-2" }),
                        React.createElement('div', { className: "flex items-center gap-1" },
                            React.createElement('span', { className: "text-xs text-slate-500 uppercase font-bold mr-1" }, "Exportar:"),
                            React.createElement('button', { onClick: exportCSV, title: "Exportar para Excel (CSV)", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-green-400 border border-slate-700" }, React.createElement(FileSpreadsheet, { size: 16 })),
                            React.createElement('button', { onClick: exportFFmpeg, title: "Script Corte (Windows .bat)", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-yellow-400 border border-slate-700" }, React.createElement(Film, { size: 16 })),
                            React.createElement('button', { onClick: exportFFmpegMac, title: "Script Corte (Mac/Linux .command)", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-white border border-slate-700" }, React.createElement(Terminal, { size: 16 })),
                            React.createElement('button', { onClick: exportXML, title: "Exportar XML", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-blue-400 border border-slate-700" }, React.createElement(FileJson, { size: 16 })),
                        ),

                        React.createElement('div', { className: "h-6 w-px bg-slate-800 mx-2" }),
                        
                        // Botões de Projeto (Guardar/Abrir)
                        React.createElement('input', { type: "file", accept: ".json", onChange: loadProject, ref: projectInputRef, className: "hidden" }),
                        React.createElement('button', { onClick: saveProject, title: "Guardar Projeto", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-slate-300 border border-slate-700" }, React.createElement(Save, { size: 16 })),
                        React.createElement('button', { onClick: () => projectInputRef.current.click(), title: "Abrir Projeto", className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-md text-slate-300 border border-slate-700" }, React.createElement(FolderInput, { size: 16 })),

                        React.createElement('div', { className: "h-6 w-px bg-slate-800 mx-2" }),

                        React.createElement('button', { onClick: () => setIsConfigModalOpen(true), className: "flex items-center gap-2 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-md text-sm font-medium transition-colors border border-slate-700" }, React.createElement(Settings, { size: 16 }), "Equipas"),
                        React.createElement('input', { type: "file", accept: "video/*", onChange: handleFileUpload, ref: fileInputRef, className: "hidden" }),
                        React.createElement('button', { onClick: () => fileInputRef.current.click(), className: "flex items-center gap-2 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 rounded-md text-sm font-medium text-white transition-colors shadow-lg ml-2" }, React.createElement(Upload, { size: 16 }), "Vídeo")
                    )
                ),

                // Layout Principal
                React.createElement('div', { className: "flex flex-1 overflow-hidden" },
                    // Esquerda: Vídeo
                    React.createElement('div', { className: "flex-1 flex flex-col p-4 gap-4 relative" },
                        React.createElement('div', { className: "flex-1 bg-black rounded-xl overflow-hidden shadow-2xl relative flex items-center justify-center border border-slate-800 group" },
                            videoSrc ? React.createElement('video', { ref: videoRef, src: videoSrc, className: "w-full h-full object-contain", onClick: togglePlay, onTimeUpdate: () => setCurrentTime(videoRef.current.currentTime), onLoadedMetadata: () => setDuration(videoRef.current.duration) }) : React.createElement('div', { className: "text-slate-500" }, "Carregue um vídeo"),
                            inPoint !== null && React.createElement('div', { className: "absolute top-4 left-4 bg-green-500/90 text-white px-3 py-1 rounded text-xs font-bold" }, `IN: ${formatTime(inPoint)}`)
                        ),
                        React.createElement('div', { className: "h-24 bg-slate-900 rounded-xl border border-slate-800 p-4 flex flex-col gap-2" },
                            React.createElement('input', { type: "range", min: "0", max: duration || 100, value: currentTime, onChange: (e) => { const t = parseFloat(e.target.value); setCurrentTime(t); if(videoRef.current) videoRef.current.currentTime = t; }, className: "w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500" }),
                            React.createElement('div', { className: "flex items-center justify-between mt-1" },
                                React.createElement('div', { className: "flex items-center gap-4" },
                                    React.createElement('button', { onClick: togglePlay, className: "p-2 bg-slate-800 hover:bg-slate-700 rounded-full" }, isPlaying ? React.createElement(Pause, { size: 20 }) : React.createElement(Play, { size: 20 })),
                                    React.createElement('span', { className: "text-sm font-mono text-slate-300" }, `${formatTime(currentTime)} / ${formatTime(duration)}`)
                                ),
                                React.createElement('div', { className: "flex items-center gap-2 bg-slate-800 rounded-lg p-1" },
                                    React.createElement('button', { onClick: () => setActiveTeam('A'), className: `px-3 py-1 text-xs font-bold rounded ${activeTeam==='A'?'bg-blue-600 text-white':'text-slate-400'}` }, `[A] ${matchInfo.teamA}`),
                                    React.createElement('button', { onClick: () => setActiveTeam('B'), className: `px-3 py-1 text-xs font-bold rounded ${activeTeam==='B'?'bg-red-600 text-white':'text-slate-400'}` }, `[S] ${matchInfo.teamB}`)
                                ),
                                React.createElement('div', { className: "flex gap-2" },
                                    React.createElement('button', { onClick: setIn, className: `px-4 py-1.5 rounded font-bold text-xs ${inPoint!==null?'bg-green-600 text-white':'bg-slate-800 text-slate-400'}` }, "Z: INÍCIO"),
                                    React.createElement('button', { onClick: setOutAndOpenModal, className: "px-4 py-1.5 bg-red-600 text-white rounded font-bold text-xs" }, "X: FIM")
                                )
                            )
                        )
                    ),
                    
                    // Direita: Lista de Cortes + Filtros
                    React.createElement('div', { className: "w-80 bg-slate-900 border-l border-slate-800 flex flex-col" },
                        React.createElement('div', { className: "p-4 border-b border-slate-800 bg-slate-900 z-10 space-y-3" },
                            React.createElement('div', { className: "flex justify-between items-center" },
                                React.createElement('h2', { className: "font-bold flex items-center gap-2" }, React.createElement(Tag, { size: 16, className: "text-blue-500" }), `Cortes (${filteredClips.length})`),
                                React.createElement('button', { onClick: () => setShowFilters(!showFilters), className: `p-1.5 rounded ${showFilters ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400'}` }, React.createElement(Filter, { size: 16 }))
                            ),
                            showFilters && React.createElement('div', { className: "bg-slate-800 p-3 rounded-lg text-xs space-y-2 animate-in slide-in-from-top-2" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-slate-400 mb-1" }, "Equipa"),
                                    React.createElement('select', { value: filters.team, onChange: e => setFilters({...filters, team: e.target.value}), className: "w-full bg-slate-900 border border-slate-700 rounded p-1" },
                                        React.createElement('option', { value: "all" }, "Todas"),
                                        React.createElement('option', { value: "A" }, matchInfo.teamA),
                                        React.createElement('option', { value: "B" }, matchInfo.teamB)
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-slate-400 mb-1" }, "Etiqueta"),
                                    React.createElement('select', { value: filters.tag, onChange: e => setFilters({...filters, tag: e.target.value}), className: "w-full bg-slate-900 border border-slate-700 rounded p-1" },
                                        React.createElement('option', { value: "all" }, "Todas"),
                                        Object.values(staticCategories).flat().map(t => React.createElement('option', { key: t, value: t }, t))
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-slate-400 mb-1" }, "Jogador"),
                                    React.createElement('select', { value: filters.player, onChange: e => setFilters({...filters, player: e.target.value}), className: "w-full bg-slate-900 border border-slate-700 rounded p-1" },
                                        React.createElement('option', { value: "all" }, "Todos"),
                                        [...matchInfo.playersA, ...matchInfo.playersB].map(p => React.createElement('option', { key: p.id, value: p.id }, `${p.number} - ${p.name}`))
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex-1 overflow-y-auto p-3 space-y-3" },
                            filteredClips.length === 0 ? React.createElement('div', { className: "text-center mt-10 p-6 opacity-40 text-xs" }, "Nenhum corte encontrado.") : filteredClips.map(clip => React.createElement('div', { key: clip.id, className: "bg-slate-800 rounded-lg p-3 border border-slate-700 relative overflow-hidden" },
                                React.createElement('div', { className: `absolute left-0 top-0 bottom-0 w-1 ${clip.team === 'A' ? 'bg-blue-500' : 'bg-red-500'}` }),
                                React.createElement('div', { className: "flex justify-between mb-1 pl-2" },
                                    React.createElement('span', { className: "text-xs font-mono text-slate-400" }, `${formatTime(clip.start)} - ${formatTime(clip.end)}`),
                                    React.createElement('button', { onClick: () => deleteClip(clip.id) }, React.createElement(Trash2, { size: 12, className: "text-slate-600 hover:text-red-500" }))
                                ),
                                React.createElement('div', { className: "flex flex-wrap gap-1 pl-2 mb-1" }, clip.tags.map(t => React.createElement('span', { key: t, className: "text-[9px] bg-slate-900 px-1.5 py-0.5 rounded border border-slate-700 text-slate-300" }, t))),
                                clip.players.length > 0 && React.createElement('div', { className: "flex flex-wrap gap-1 pl-2 mb-1" }, clip.players.map(p => React.createElement('span', { key: p.id, className: "text-[9px] bg-slate-700 px-1.5 py-0.5 rounded text-slate-200" }, `#${p.number} ${p.name.split(' ')[0]}`))),
                                React.createElement('button', { onClick: () => jumpToClip(clip.start), className: "w-full mt-2 text-[10px] bg-slate-700 py-1 rounded hover:bg-slate-600 flex justify-center items-center gap-1" }, React.createElement(RotateCcw, { size: 10 }), "Rever")
                            ))
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
